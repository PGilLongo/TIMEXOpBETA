<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAVEGADOR</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map = L.map('map').setView([0, 0], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        let userMarker = L.marker([0, 0]).addTo(map);
        let lastPosition = null;

        // Función para calcular el rumbo entre dos puntos geográficos
        function calculateHeading(lat1, lon1, lat2, lon2) {
            const rad = Math.PI / 180;
            lat1 *= rad;
            lon1 *= rad;
            lat2 *= rad;
            lon2 *= rad;

            const dLon = lon2 - lon1;
            const y = Math.sin(dLon) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
            const heading = Math.atan2(y, x);
            return (heading * 180 / Math.PI + 360) % 360; // Convertir a grados y asegurar valor entre 0-360
        }

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(function(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                userMarker.setLatLng([lat, lon]);

                // Actualizar la vista del mapa con la ubicación actual
                map.setView([lat, lon], 13);

                // Calcular el rumbo si tenemos una posición anterior
                if (lastPosition) {
                    const heading = calculateHeading(lastPosition.lat, lastPosition.lon, lat, lon);
                    map.setBearing(heading);  // Rotar el mapa según el rumbo calculado
                }

                lastPosition = { lat, lon };  // Guardar la posición actual para la próxima iteración
            }, function(error) {
                console.error("Error obteniendo ubicación:", error);
            }, {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 5000
            });
        } else {
            alert("Geolocalización no soportada por este navegador.");
        }
    </script>
</body>
</html>
